function loadAssets(e){document.getElementById("loadingDiv").style.display="flex",e.load.on("progress",e=>{e=parseInt(100*e);document.getElementById("loadingProgressText").innerText=e+" %"}),e.load.on("complete",()=>{document.getElementById("loadingProgressText").innerText="Starting game..."}),e.load.image("lobby","/ImageComponents/Lobby/Lobby Island.png"),e.load.image("rock","/ImageComponents/Objects/Rock.png"),e.load.image("tree","/ImageComponents/Objects/Tree.png"),e.load.spritesheet("spawner","/ImageComponents/Sprite Sheets/Spawner Sprite Sheet.png",{frameWidth:1056,frameHeight:800}),e.load.image("loggedIcon","/ImageComponents/UI/Login Icon.png"),e.load.image("guestIcon","/ImageComponents/UI/Guest Icon.png"),e.load.spritesheet("guestPlayerIdle","https://i.imgur.com/4BkMHTS.png",{frameWidth:320,frameHeight:800}),e.load.spritesheet("guestPlayerFront","https://i.imgur.com/Qq3Yedn.png",{frameWidth:320,frameHeight:800}),e.load.spritesheet("guestPlayerBack","https://i.imgur.com/xhU6u5B.png",{frameWidth:320,frameHeight:800}),e.load.spritesheet("spawnEffect","/ImageComponents/Sprite Sheets/Spawn effect sprite sheet.png",{frameWidth:1024,frameHeight:1024})}let canvasSize={width:1e3,height:500},worldBounds={width:1200,height:1e3},centerWorld={width:worldBounds.width/2,height:worldBounds.height/2},speed=200,isTalking=!1,isPanelOpen=!1,isFront=!1,isBack=!1;class gameLobby extends Phaser.Scene{constructor(){super("Game Lobby")}preload=function(){loadAssets(this)};create=function(){document.getElementById("loadingDiv").style.display="none",this.physics.world.setBounds(0,0,worldBounds.width,worldBounds.height),this.lobby=this.add.image(centerWorld.width,centerWorld.height,"lobby").setOrigin(.5),this.lobby.setDisplaySize(worldBounds.width,worldBounds.height),this.topZone=this.physics.add.staticSprite(0,100).setOrigin(.5),this.topZone.setDisplaySize(worldBounds.width,100),this.topZone.body.setSize(worldBounds.width,100,!0),this.topZone.body.setOffset(0,0),this.bottomZone=this.physics.add.staticSprite(0,770).setOrigin(.5),this.bottomZone.setDisplaySize(worldBounds.width,100),this.bottomZone.body.setSize(worldBounds.width,100,!0),this.bottomZone.body.setOffset(0,0),this.leftZone=this.physics.add.staticSprite(100,0).setOrigin(.5),this.leftZone.setDisplaySize(100,worldBounds.height),this.leftZone.body.setSize(100,worldBounds.height,!0),this.leftZone.body.setOffset(0,0),this.rightZone=this.physics.add.staticSprite(1e3,0).setOrigin(.5),this.rightZone.setDisplaySize(100,worldBounds.height),this.rightZone.body.setSize(100,worldBounds.height,!0),this.rightZone.body.setOffset(0,0),this.player=this.physics.add.sprite(0,0,"guestPlayerIdle").setOrigin(.5),this.player.setScale(.1),this.player.setVisible(!1),this.anims.create({key:"playerIdle",frames:this.anims.generateFrameNumbers("guestPlayerIdle",{start:0,end:1}),frameRate:4,repeat:-1}),this.anims.create({key:"playerFront",frames:this.anims.generateFrameNumbers("guestPlayerFront",{start:0,end:1}),frameRate:4,repeat:-1}),this.anims.create({key:"playerBack",frames:this.anims.generateFrameNumbers("guestPlayerBack",{start:0,end:1}),frameRate:4,repeat:-1});var e=CryptoJS.AES.decrypt(localStorage.getItem("tempPlayerName"),"tempPlayerName").toString(CryptoJS.enc.Utf8);this.playerName=this.add.text(0,-50,e,{font:"16px 'Pixelify Sans'",fill:"#06402b",align:"center"}).setOrigin(.5),this.playerContainer=this.add.container(centerWorld.width+50,centerWorld.height,[this.player,this.playerName]),this.physics.world.enable(this.playerContainer),this.playerContainer.body.setCollideWorldBounds(!0),this.playerContainer.body.setSize(40,70),this.playerContainer.body.setOffset(-20,-35),this.playerContainer.setDepth(1),this.tree=this.add.sprite(centerWorld.width+245,centerWorld.height-480,"tree").setOrigin(.5).setDisplaySize(300,380).setDepth(0),this.spawnSmoke=this.add.sprite(centerWorld.width,centerWorld.height-50,"spawn_smoke").setOrigin(.5),this.spawnSmoke.setDisplaySize(2,5),this.spawnSmoke.setDepth(2),this.anims.create({key:"spawnDust",frames:this.anims.generateFrameNumbers("spawnEffect",{start:0,end:8}),frameRate:12,repeat:0}),this.spawnSmoke.play("spawnDust"),this.spawnSmoke.on("animationcomplete",()=>{this.spawnSmoke.destroy(),this.player.setVisible(!0)}),this.spawner=this.physics.add.staticSprite(centerWorld.width,centerWorld.height,"spawner").setOrigin(.5),this.spawner.setDisplaySize(60,50),this.spawner.body.setSize(60,20,!0),this.spawner.body.setOffset(500,400),this.spawner.setDepth(2),this.anims.create({key:"spawnerPod",frames:this.anims.generateFrameNumbers("spawner",{start:0,end:2}),frameRate:6,repeat:-1}),this.spawner.play("spawnerPod"),this.physics.add.collider(this.playerContainer,this.spawner),this.rockGroup=this.physics.add.staticGroup(),[this.rockGroup.create(300,400,"rock").setOrigin(.5).setDisplaySize(80,60).setDepth(2),this.rockGroup.create(500,200,"rock").setOrigin(.5).setDisplaySize(80,60).setDepth(2),this.rockGroup.create(800,550,"rock").setOrigin(.5).setDisplaySize(80,60).setDepth(2),this.rockGroup.create(400,600,"rock").setOrigin(.5).setDisplaySize(80,60).setDepth(2)].forEach(e=>{e.body.setSize(60,20,!0),e.body.setOffset(480,520)}),this.physics.add.collider(this.playerContainer,this.rockGroup),this.physics.add.collider(this.playerContainer,this.topZone),this.physics.add.collider(this.playerContainer,this.bottomZone),this.physics.add.collider(this.playerContainer,this.leftZone),this.physics.add.collider(this.playerContainer,this.rightZone),this.cameras.main.startFollow(this.playerContainer),this.cameras.main.setBounds(0,0,worldBounds.width,worldBounds.height),this.cursors=this.input.keyboard.createCursorKeys(),this.W=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.W),this.A=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.A),this.S=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S),this.D=this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D),this.input.keyboard.enableGlobalCapture(),this.loggedInIcon=this.add.image(70,0,"loggedIcon").setDisplaySize(30,30),this.loggedInLabel=this.add.text(0,0,"Log In",{font:"16px 'Pixelify Sans",fill:"#ffffff",align:"center"}).setOrigin(.5),this.button_Background=this.add.graphics(),this.button_Background.fillStyle(3176959,1),this.button_Background.fillRoundedRect(-75,-20,170,40,10),this.loggedInContainer=this.add.container(canvasSize.width-110,40,[this.button_Background,this.loggedInIcon,this.loggedInLabel]),this.loggedInContainer.setScrollFactor(0).setDepth(5).setSize(170,40),this.loggedInContainer.setInteractive({useHandCursor:!0}),this.loggedInContainer.on("pointerdown",()=>{isTalking=!0,isPanelOpen=!0,modalStatus("loginDiv","flex","modalAnimation")}),this.guestIcon=this.add.image(70,0,"guestIcon").setDisplaySize(30,30),this.guestLabel=this.add.text(0,0,"Play as Guest",{font:"16px 'Pixelify Sans",fill:"#ffffff",align:"center"}).setOrigin(.5),this.guestButton_Background=this.add.graphics(),this.guestButton_Background.fillStyle(3176959,1),this.guestButton_Background.fillRoundedRect(-75,-20,170,40,10),this.guestContainer=this.add.container(canvasSize.width-110,100,[this.guestButton_Background,this.guestIcon,this.guestLabel]),this.guestContainer.setScrollFactor(0).setDepth(5).setSize(170,40),this.guestContainer.setInteractive({useHandCursor:!0}),this.guestContainer.on("pointerdown",async()=>{document.getElementById("processingDiv").style.display="flex";var e=CryptoJS.AES.decrypt(localStorage.getItem("tempPlayerName"),"tempPlayerName").toString(CryptoJS.enc.Utf8),t=await setCookie(e,"guest");t.status&&(document.getElementById("processingDiv").style.display="none",e)&&(socket.emit("redirectToBase",e),window.location.href="/Game/Base/"+replaceSlashWithUnderscore(t.encryptUser),localStorage.removeItem("tempPlayerName"))}),sceneSocket(this),lobbyUI(this)};update=function(){this.playerContainer.body.setVelocity(0),0==isTalking&&((this.cursors.left.isDown||this.A.isDown)&&(this.playerContainer.body.setVelocityX(-speed),this.player.flipX=!1,isFront=!1,isBack=!1),(this.cursors.right.isDown||this.D.isDown)&&(this.playerContainer.body.setVelocityX(speed),this.player.flipX=!0,isFront=!1,isBack=!1),(this.cursors.up.isDown||this.W.isDown)&&(this.playerContainer.body.setVelocityY(-speed),isFront=!1,isBack=!0),this.cursors.down.isDown||this.S.isDown)&&(this.playerContainer.body.setVelocityY(speed),isFront=!0,isBack=!1),isTalking&&this.input.keyboard.disableGlobalCapture(),isFront&&this.player.play("playerFront",!0),isBack&&this.player.play("playerBack",!0),isFront||isBack||this.player.play("playerIdle",!0);var e={playerID:CryptoJS.AES.decrypt(localStorage.getItem("tempPlayerName"),"tempPlayerName").toString(CryptoJS.enc.Utf8),x:this.playerContainer.x,y:this.playerContainer.y,isBack:isBack,isFront:isFront,spriteX:this.player.flipX};socket.emit("playerMove",e),socket.emit("existingPlayer",e)}}let config={type:Phaser.CANVAS,width:canvasSize.width,height:canvasSize.height,canvas:gameCanvas,physics:{default:"arcade",arcade:{gravity:{y:0},debug:!1}},scene:[gameLobby]},game=(WebFont.load({google:{families:["Pixelify Sans"]}}),new Phaser.Game(config)),loggedIn_playerName,userProfile;function sceneSocket(n){n.playerCollection=new Map,socket.on("playerDisconnect",e=>{var s=n.playerCollection.get(e);if(s){let{playerName:e,container:t,playerSprite:i}=s;e.destroy(),i.destroy(),t.destroy(),n.playerCollection.delete(e)}}),socket.on("spawnPlayer",e=>{let t=CryptoJS.AES.decrypt(localStorage.getItem("tempPlayerName"),"tempPlayerName").toString(CryptoJS.enc.Utf8);setTimeout(()=>{t!==e&&(n.joinedPlayer=n.physics.add.sprite(0,0,"guestPlayerIdle").setOrigin(.5),n.joinedPlayer.setScale(.1),n.joinedPlayer.setVisible(!1),n.joinedPlayerName=n.add.text(0,-50,e,{font:"16px 'Pixelify Sans'",fill:"#ffffff",align:"center"}).setOrigin(.5),n.joinedPlayerContainer=n.add.container(centerWorld.width+50,centerWorld.height,[n.joinedPlayer,n.joinedPlayerName]),n.joinedPlayerContainer.setDepth(2),n.spawnSmoke=n.add.sprite(centerWorld.width,centerWorld.height-50,"spawn_smoke").setOrigin(.5),n.spawnSmoke.setDisplaySize(2,5),n.spawnSmoke.setDepth(1),n.spawnSmoke.play("spawnDust"),n.spawnSmoke.on("animationcomplete",()=>{n.spawnSmoke.destroy(),n.joinedPlayer.setVisible(!0)}),n.playerCollection.set(e,{playerName:n.joinedPlayerName,container:n.joinedPlayerContainer,playerSprite:n.joinedPlayer}))},1e3)}),socket.on("existingPlayer",e=>{let{playerID:t,playerX:i,playerY:s}=e;setTimeout(()=>{n.playerCollection.has(t)||(n.joinedPlayer=n.physics.add.sprite(0,0,"guestPlayerIdle").setOrigin(.5),n.joinedPlayer.setScale(.1),n.joinedPlayer.setVisible(!0),n.joinedPlayerName=n.add.text(0,-50,t,{font:"16px 'Pixelify Sans'",fill:"#ffffff",align:"center"}).setOrigin(.5),n.joinedPlayerContainer=n.add.container(i,s,[n.joinedPlayer,n.joinedPlayerName]),n.joinedPlayerContainer.setDepth(1),n.playerCollection.set(t,{playerName:n.joinedPlayerName,container:n.joinedPlayerContainer,playerSprite:n.joinedPlayer}))},1e3)}),socket.on("playerMove",e=>{var t,{playerID:e,x:i,y:s,isBack:a,isFront:r,spriteX:o}=e,e=n.playerCollection.get(e);e&&({container:e,playerSprite:t}=e,e.setPosition(i,s),t.flipX=o,r?t.play("playerFront",!0):a?t.play("playerBack",!0):t.play("playerIdle",!0))}),socket.on("redirectToBase",e=>{var s=n.playerCollection.get(e);if(s){let{playerName:e,container:t,playerSprite:i}=s;e.destroy(),i.destroy(),t.destroy(),n.playerCollection.delete(e)}})}socket.on("connect",()=>{var e="Guest_"+(e=>{let t="";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",s=i.length;let a=0;for(;a<e;)t+=i.charAt(Math.floor(Math.random()*s)),a+=1;return t})(5),t=CryptoJS.AES.encrypt(e,"tempPlayerName");localStorage.getItem("tempPlayerName")||localStorage.setItem("tempPlayerName",t.toString()),socket.emit("playerDisconnect",localStorage.getItem("tempPlayerName")),socket.emit("playerConnected",localStorage.getItem("tempPlayerName")),socket.emit("spawnPlayer",localStorage.getItem("tempPlayerName")),socket.emit("game_playerDisconnect"),loggedIn_playerName=e,userProfile="https://i.imgur.com/ajVzRmV.jpg"});